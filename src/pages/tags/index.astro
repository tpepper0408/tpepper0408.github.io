---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');

// Get all unique tags with post counts
const tagCounts = allPosts.reduce((acc, post) => {
  post.data.tags?.forEach((tag: string) => {
    acc[tag] = (acc[tag] || 0) + 1;
  });
  return acc;
}, {} as Record<string, number>);

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Tags">
  <div class="mb-12">
    <div class="font-mono text-sm mb-4" style="color: var(--text-secondary);">
      <span class="text-accent-cyan">ls</span> ./tags
    </div>
    
    <h1 class="text-5xl font-display font-bold mb-6 leading-tight">
      All Tags
    </h1>
    
    <p class="text-xl" style="color: var(--text-secondary);">
      Browse posts by topic
    </p>
  </div>

  <div class="h-px bg-gradient-to-r from-transparent via-accent-cyan to-transparent mb-12 opacity-30"></div>

  {sortedTags.length > 0 ? (
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {sortedTags.map(([tag, count]) => (
        <a 
          href={`/tags/${tag}`}
          class="group block border rounded-lg p-6 hover:border-accent-cyan transition-all duration-300 hover:shadow-[0_0_20px_rgba(0,255,255,0.1)]"
          style="border-color: var(--border);"
        >
          <div class="flex items-center justify-between">
            <span class="text-xl font-display font-semibold group-hover:text-accent-cyan transition-colors">
              #{tag}
            </span>
            <span class="font-mono text-sm px-2 py-1 rounded" style="background-color: var(--code-bg); color: var(--text-secondary);">
              {count}
            </span>
          </div>
        </a>
      ))}
    </div>
  ) : (
    <div class="text-center py-16">
      <p class="font-mono text-lg" style="color: var(--text-secondary);">
        <span class="text-accent-cyan">$</span> echo "No tags yet"
      </p>
    </div>
  )}
</BaseLayout>
